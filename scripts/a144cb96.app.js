(function(){var e;e=console.log,e=function(){},this.ESTreeMap=function(){function t(){}return t.prototype.process=function(t){return{name:"root",children:_.map(t.indices,function(t,n){return e("processing index "+n+" with "+t.shards.length+" shards"),{name:n,children:_.map(t.shards,function(t,r){return e("	processing shard #"+r+" with "+t.length+" replicas"),{name:"i-"+n+"/"+r,children:_.map(t,function(i,o){return e("		processing replica #"+o+" with "+t.length+" replicas"),e("			 Node: "+i.routing.node+", docs: "+i.docs.num_docs),{name:""+n+":s"+r+":"+o,size:i.docs.num_docs}})}})}})}},t.prototype.smartpath=function(){var e,t,n;for(n=[].shift,t=n.apply(arguments);e=n.apply(arguments);)t[e]||(t[e]={}),t=t[e];return t},t.prototype.process_node=function(t,n){var r,i,o,a,s=this;return o={},o.name="root",r={},i=_.map(n.indices,function(t,n){return _.map(t.shards,function(t,r){return _.map(t,function(t,i){return e(["children",t.routing.node,"indices",n,"s-"+r,"r-"+i].join(":")),s.smartpath(o,"nodes",t.routing.node,"indices",n,"shards","s-"+r,"replicas","r-"+i).size=t.docs.num_docs})})}),a={name:"root",children:_.map(o.nodes,function(n,i){return e("processing node "+i),{name:i,label:""+t.nodes[i].name+" ("+t.nodes[i].version+")",type:"node",children:_.map(n.indices,function(t,n){return e("	processing index "+n),{name:""+n+":"+i,label:n,colortag:n,children:_.map(t.shards,function(t,o){return e("		processing shard "+o),{name:""+o+":"+n+":"+i,colortag:n,label:o,children:_.map(t.replicas,function(t,a){return r[n]||(r[n]=0),r[n]+=t.size,e("			processing replica "+a),{name:""+a+":"+o+":"+n+":"+i,label:""+a+", "+t.size+" docs",colortag:n,size:t.size}})}})}})}})},[r,a]},t}()}).call(this),function(){this.UrlTextView=Em.TextField.extend({elementId:"url-input",obtainFocusWhenEmpty:function(){return this.get("value")?void 0:this.$().focus()}.observes("value"),didInsertElement:function(){return $(document).foundation(),this.focus()},focus:function(){return this.$().focus()},insertNewline:function(){var e,t,n=this;return console.log(this.get("value")),e=$("#poller-select").val(),this.poller&&(clearInterval(this.poller),this.poller=null),e>0&&(t=this.get("value"),this.poller=setInterval(function(){return console.log("Now polling. (set to every "+e+" minutes)"),n.set("url",null),n.set("url",t)},60*1e3*e)),this.set("url",this.get("value"))}})}.call(this),function(){this.ESTreeView=Ember.View.extend({didInsertElement:function(){return this.spinner=$("#es-tree-view-spinner")},renderTree:function(){var e,t=this;return this.spinner.show(),(e=this.get("parentView.url"))?d3.json(""+e+"/_cluster/nodes",function(e,n){return e?(t.spinner.hide(),console.log("XHR Error:",e),void 0):d3.json(""+t.get("parentView.url")+"/_status",function(e,r){var i,o,a,s,u,l,c,h,f,p,d,m,g,b;return t.spinner.hide(),e?(console.log("XHR Error:",e),void 0):(h={top:40,right:10,bottom:10,left:10},b=1252,s=500,d=["#A35840","#DC4B41","#E6E4AF","#7C7B4A","#B2B4A5","#505937","#A7C269","#F7BA18","#FDFEFD","#58B0D5","#A0DCF8"],p=["#69D2E7","#A7DBD8","#E0E4CC","#F38630","#FA6900","#CBE86B","#556270","#4ECDC4","#C7F464","#FF6B6B"],i=d3.scale.ordinal().range(p),m=d3.format(",.2s"),g=d3.layout.treemap().size([b,s]).sticky(!0).padding(function(e){return"node"===e.type?25:null}).value(function(e){return e.size}),$("#"+t.elementId).empty(),a=d3.select("#"+t.elementId).append("div").style("position","relative").style("width",b+h.left+h.right+"px").style("height",s+h.top+h.bottom+"px"),o=(new ESTreeMap).process_node(n,r),r=o[1],l=o[0],u=_.keys(l),i.domain(u),c=d3.select("#"+t.elementId).append("div").attr("class","legend").attr("width","100%").attr("height",20*i.domain().length).selectAll("div").data(u).enter().append("div").attr("class","legend"),c.append("div").attr("class","legend-color").attr("height",18).style("background",i),c.append("div").attr("class","legend-label").text(function(e){return e+", "+m(l[e])+" (replicated)"}),f=a.datum(r).selectAll(".node").data(g.nodes).enter().append("div").attr("class","node").style("left",function(e){return e.x+"px"}).style("top",function(e){return e.y+"px"}).style("width",function(e){return Math.max(0,e.dx-1)+"px"}).style("height",function(e){return Math.max(0,e.dy-1)+"px"}).style("background",function(e){return e.children?i(e.colortag):null}).text(function(e){return"node"===e.type?e.label:e.children?null:m(e.size)}))})}):void 0}.observes("parentView.url")})}.call(this),function(){var e;e=window.App=Ember.Application.create()}.call(this);